{
    "variables":
    {
      "cpu": "1",
      "ram": "512",
      "name": "alpine",
      "disk_size": "5000",
      "version": "3.9",
      "iso_checksum_type": "sha256",
      "iso_urls": "https://nl.alpinelinux.org/alpine/latest-stable/releases/x86_64/alpine-virt-3.9.3-x86_64.iso",
      "iso_checksum": "98e2eb7cfe74ede72d99cfd574a3c5e85a9aca5743d786abc9bbe7e0923f211b",
      "headless": "false",
      "config_file": "setup-alpine.sh",
      "ssh_username": "root",
      "ssh_password": "testtest",
      "destination_server": "get.goffinet.org"
    },
   "builders": [
    {
    	"type": "qemu",
      "qemu_binary": "/usr/bin/qemu-system-x86_64",
	    "iso_url": "{{user `iso_urls`}}",
	    "iso_checksum": "{{user `iso_checksum`}}",
	    "iso_checksum_type": "{{user `iso_checksum_type`}}",
	    "output_directory": "artifacts/qemu/{{user `name`}}{{user `version`}}",
	    "shutdown_command": "poweroff",
	    "disk_size": "{{user `disk_size`}}",
	    "format": "qcow2",
	    "headless": "{{user `headless`}}",
	    "accelerator": "kvm",
	    "ssh_host_port_min": 2222,
	    "ssh_host_port_max": 2229,
	    "ssh_username": "root",
	    "ssh_password": "{{user `ssh_password`}}",
	    "ssh_port": 22,
	    "ssh_wait_timeout": "5m",
    	"vm_name": "{{user `name`}}{{user `version`}}",
	    "net_device": "virtio-net",
	    "disk_interface": "virtio",
	    "boot_wait": "60s",
	    "boot_command":
	    [
      "root<enter>",
	    "passwd<enter>{{user `ssh_password`}}<enter>{{user `ssh_password`}}<enter>",
	    "apk add openssh<enter>",
	    "echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config<enter>",
	    "ifconfig eth0 up && udhcpc -i eth0<enter>",
	    "/etc/init.d/sshd start<enter><wait>"
	    ]
    }
  ],
  "provisioners": [
	  {
	  "type": "shell",
	  "script": "install.sh",
	  "environment_vars": ["ROOT_PASSWORD={{user `ssh_password`}}"]
	  },
    {
      "type": "shell",
      "inline": [
        "apk add ansible"
      ]
    },
    {
      "type": "ansible-local",
      "playbook_file": "ansible/playbook.yml",
      "playbook_dir": "ansible"
    },
    {
      "type": "shell",
      "inline": [
        "apk del ansible"
      ]
    }
  ]
}
